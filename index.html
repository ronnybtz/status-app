<script>
  const PIN = "1234"; // ÄNDERN

  const statusText = document.getElementById("statusText");
  const editBtn = document.getElementById("editBtn");
  const editor = document.getElementById("editor");
  const saveBtn = document.getElementById("saveBtn");
  const statusSelect = document.getElementById("statusSelect");
  const pinInput = document.getElementById("pinInput");

  const colors = {
    "In Sondelfingen": "#16a34a",
    "In Schwenningen": "#2563eb",
    "In Immenhausen": "#7c3aed",
    "Arbeiten": "#f59e0b",
    "Unterwegs": "#ef4444"
  };

  function updateStatusUI(status) {
    statusText.textContent = status;
    statusText.style.background = colors[status] || "#333";
  }

  // Funktion, um Status von status.json zu laden
  async function loadStatus() {
    try {
      const res = await fetch("status.json?" + new Date().getTime()); // Cache umgehen
      const data = await res.json();
      statusSelect.value = data.status;
      updateStatusUI(data.status);
    } catch (err) {
      console.error("Fehler beim Laden des Status:", err);
      statusSelect.value = "In Sondelfingen";
      updateStatusUI("In Sondelfingen");
    }
  }

  // Beim Laden der Seite
  loadStatus();

  // Alle 30 Sekunden Status automatisch neu laden
  setInterval(loadStatus, 10000);

  editBtn.onclick = () => {
    editor.classList.toggle("hidden");
  };

  saveBtn.onclick = () => {
    if (pinInput.value !== PIN) {
      alert("Falscher PIN");
      return;
    }

    const newStatus = statusSelect.value;

    alert("Um den Status für alle zu ändern, bitte status.json im Repo aktualisieren:\n\n" +
          `Neuer Status: "${newStatus}"`);

    editor.classList.add("hidden");
    pinInput.value = "";
  };

  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
  }
</script>
